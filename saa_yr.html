<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="noindex">
<title>Sää — seuraavat 12 h (Yr/MET)</title>
<style>
  :root { color-scheme: dark; }
  html,body{height:100%}
  body{
    margin:0; padding:20px 16px 28px;
    background:#000; color:#e8e8e8;
    font: 17px/1.5 Arial, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, sans-serif;
    -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
  }
  h1{ font-size:18px; margin:0 0 10px; font-weight:600; letter-spacing:.2px; }
  .sub{ color:#9aa; font-size:13px; margin:0 0 14px; }
  .row{ display:grid; grid-template-columns: 54px 60px 1fr 70px 64px;
        gap:8px; padding:6px 0; border-bottom:1px solid #1c1c1c; }
  .row.head{ color:#a8b0ba; border-color:#2a2a2a; padding-top:0; }
  .muted{ color:#95a0aa; }
  .err{ color:#ff6b6b; white-space:pre-wrap; }
  .ok{ color:#8ff098; }
  .spinner{ display:inline-block; width:14px; height:14px; border:2px solid #2b2b2b; border-top-color:#7d7d7d; border-radius:50%; animation:spin .8s linear infinite; vertical-align:-2px; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>

<h1>Seuraavat 12 h</h1>
<p class="sub" id="meta"><span class="spinner"></span> Ladataan ennustetta Yr/MET:ltä…</p>

<div class="row head">
  <div>klo</div><div>°C</div><div>kuvaus</div><div>sade</div><div>tuuli</div>
</div>
<div id="out" aria-live="polite"></div>

<script>
const urlParams = new URLSearchParams(location.search);
const LAT = urlParams.get('lat') || '60.1699';
const LON = urlParams.get('lon') || '24.9384';
const TZ  = 'Europe/Helsinki';

const apiUrl = `https://api.met.no/weatherapi/locationforecast/2.0/compact?lat=${encodeURIComponent(LAT)}&lon=${encodeURIComponent(LON)}`;

const metaEl = document.getElementById('meta');
const outEl  = document.getElementById('out');

const codeText = (code) => {
  if (!code) return '';
  const base = String(code).split('_')[0];
  const m = {
    clearsky:'selkeää', fair:'puolipilvistä', partlycloudy:'puolipilvistä',
    cloudy:'pilvistä', fog:'sumua', lightrain:'heikkoa sadetta',
    rain:'sadetta', heavyrain:'rankkasadetta', snow:'lunta', heavysnow:'runsasta lunta',
    rainshowers:'sadekuuroja', lightrainshowers:'heikkoja kuuroja'
  };
  return m[base] || base;
};

// Muodostetaan formatteri, joka näyttää ajan suoraan Europe/Helsinki-ajassa
const timeFmt = new Intl.DateTimeFormat('fi-FI', {
  hour:'2-digit', minute:'2-digit', hour12:false, timeZone: TZ
});
const fmtTime
